"""
vulnerability_indicators.py - Tokens que NUNCA se modifican durante augmentation

Estas son las "señales" que el modelo debe aprender a detectar.
Si las enmascaras, el modelo pierde información crítica.
"""

VULNERABILITY_INDICATORS = {
    # =========================================================================
    # CWE-89: SQL Injection
    # =========================================================================
    'execute', 'executemany', 'executescript', 'executequery', 'executeupdate',
    'cursor', 'query', 'rawquery', 'raw', 'nativequery', 'createquery',
    'preparestatement', 'preparedstatement', 'statement',
    'select', 'insert', 'update', 'delete', 'drop', 'truncate', 'alter',
    'where', 'from', 'join', 'union', 'having', 'order', 'group',
    'sqlalchemy', 'hibernate', 'jdbc', 'mybatis', 'sequelize', 'knex',
    
    # =========================================================================
    # CWE-79: XSS (Cross-Site Scripting)
    # =========================================================================
    'innerhtml', 'outerhtml', 'innertext', 'textcontent',
    'documentwrite', 'writeln', 'createelement', 'appendchild',
    'insertadjacenthtml', 'setattribute',
    'jquery', 'html', 'append', 'prepend',
    'dangerouslysetinnerhtml',
    'bypasssecuritytrust',
    'safe', 'mark_safe', 'autoescape', 'noescape',
    
    # =========================================================================
    # CWE-78: OS Command Injection
    # =========================================================================
    'system', 'popen', 'subprocess', 'call', 'check_output', 'check_call',
    'spawn', 'fork', 'exec', 'execfile', 'execl', 'execv', 'execve',
    'shell_exec', 'passthru', 'proc_open',
    'runtime', 'getruntime', 'processbuilder',
    'child_process', 'execsync',
    'shell', 'cmd', 'command', 'bash', 'powershell',
    
    # =========================================================================
    # CWE-22: Path Traversal
    # =========================================================================
    'open', 'read', 'write', 'readfile', 'writefile',
    'fopen', 'fread', 'fwrite', 'file_get_contents', 'file_put_contents',
    'path', 'join', 'abspath', 'realpath', 'normpath',
    'dirname', 'basename', 'filepath', 'filename',
    'include', 'require', 'include_once', 'require_once',
    'sendfile', 'download', 'attachment',
    'listdir', 'scandir', 'glob', 'walk',
    'unlink', 'remove', 'delete', 'mkdir', 'rmdir',
    
    # =========================================================================
    # CWE-434: Unrestricted File Upload
    # =========================================================================
    'upload', 'fileupload', 'multipart', 'formdata',
    'saveas', 'move_uploaded_file', 'moveuploaded',
    'getoriginalfilename', 'getfilename', 'getcontenttype',
    'mimetype', 'extension', 'getsize',
    'tempfile', 'temporary',
    
    # =========================================================================
    # CWE-352: CSRF
    # =========================================================================
    'csrf', 'csrftoken', 'csrf_token', 'xsrf', 'xsrftoken',
    'antiforgery', 'validateantiforgerytoken', 'csrf_exempt',
    'samesite', 'origin', 'referer',
    
    # =========================================================================
    # CWE-502: Deserialization
    # =========================================================================
    'pickle', 'unpickle', 'loads', 'load', 'dumps', 'dump',
    'yaml', 'unsafe_load', 'marshal', 'shelve',
    'unserialize', 'serialize',
    'objectinputstream', 'readobject', 'xmldecoder',
    'deserialize', 'jsonpickle', 'dill',
    
    # =========================================================================
    # CWE-611: XXE
    # =========================================================================
    'xml', 'parse', 'parsestring', 'etree', 'minidom',
    'saxparser', 'xmlreader', 'documentbuilder',
    'loadxml', 'entity', 'dtd', 'doctype',
    
    # =========================================================================
    # CWE-918: SSRF
    # =========================================================================
    'request', 'requests', 'urllib', 'urlopen', 'httplib',
    'fetch', 'axios', 'http', 'https', 'curl', 'curl_exec',
    'httpclient', 'webclient', 'resttemplate',
    
    # =========================================================================
    # CWE-94: Code Injection
    # =========================================================================
    'eval', 'exec', 'compile', 'execfile',
    'function', 'settimeout', 'setinterval',
    'constructor', 'prototype',
    'reflection', 'invoke', 'getmethod', 'forname',
    'template', 'render', 'render_template',
    
    # =========================================================================
    # Authentication / Secrets
    # =========================================================================
    'password', 'passwd', 'secret', 'secretkey', 'apikey', 'api_key',
    'token', 'accesstoken', 'privatekey', 'credential',
    'auth', 'authenticate', 'login', 'session', 'cookie',
    'jwt', 'bearer', 'oauth',
    'hash', 'md5', 'sha1', 'sha256', 'bcrypt',
    
    # =========================================================================
    # Input Sources
    # =========================================================================
    'request', 'req', 'input', 'stdin',
    'params', 'query', 'body', 'form', 'args',
    'getparameter', 'getheader',
    'get', 'post', 'put', 'delete',
    'argv', 'environ', 'getenv',
    'userinput', 'userdata',
    
    # =========================================================================
    # Crypto (Weak)
    # =========================================================================
    'random', 'rand', 'mt_rand',
    'des', 'rc4', 'md5', 'sha1', 'ecb',
    'encrypt', 'decrypt', 'cipher',
    
    # =========================================================================
    # Memory (C/C++)
    # =========================================================================
    'strcpy', 'strcat', 'sprintf', 'gets', 'scanf',
    'memcpy', 'memmove', 'malloc', 'free',
    'buffer', 'overflow',
}

# Set para búsqueda O(1)
INDICATORS_SET = frozenset(VULNERABILITY_INDICATORS)

RESERVED_WORDS = {
    # Python
    'def', 'class', 'return', 'if', 'else', 'elif', 'for', 'while',
    'try', 'except', 'finally', 'with', 'as', 'import', 'from',
    'in', 'is', 'not', 'and', 'or', 'true', 'false', 'none',
    'self', 'cls', 'lambda', 'yield', 'async', 'await',
    'pass', 'break', 'continue', 'raise', 'assert', 'global',
    
    # JavaScript/TypeScript
    'function', 'const', 'let', 'var', 'this', 'new',
    'typeof', 'instanceof', 'null', 'undefined',
    'export', 'default', 'require', 'module',
    
    # Java/C#/C++
    'public', 'private', 'protected', 'static', 'final',
    'void', 'int', 'string', 'boolean', 'float', 'double',
    'char', 'byte', 'long', 'short', 'extends', 'implements',
    'interface', 'abstract', 'throws', 'throw', 'catch', 'super',
    
    # SQL
    'select', 'from', 'where', 'insert', 'update', 'delete',
    'join', 'into', 'values', 'set', 'order', 'by', 'group',
    'having', 'limit', 'offset', 'create', 'table', 'index',
    
    # PHP
    'echo', 'print', 'array', 'foreach', 'endif', 'endfor',
    
    # General
    'true', 'false', 'null', 'nil', 'undefined',
}

RESERVED_WORDS_SET = frozenset(word.lower() for word in RESERVED_WORDS)

def is_indicator(token: str) -> bool:
    """Verifica si un token debe preservarse."""
    return token.lower() in INDICATORS_SET

def is_preserved_token(token: str) -> bool:
    """Verifica si un token debe preservarse durante augmentation."""
    token_lower = token.lower()
    return (
        token_lower in INDICATORS_SET or
        token_lower in RESERVED_WORDS_SET
    )